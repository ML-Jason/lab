{"version":3,"sources":["js/mng/login.js"],"names":["onReady","console","log","vpath","onFailure","error","pageAlert","showError","reason","renderButton","gapi","signin2","render","scope","height","longtitle","onsuccess","onSignIn","onfailure","renderTimer","setTimeout","checkRenderButton","$","css","googleUser","profile","getBasicProfile","getId","getName","getImageUrl","getEmail","id_token","getAuthResponse","show","xhr","XMLHttpRequest","open","setRequestHeader","onload","responseText","_obj","parseJSON","status","signOut","message","location","replace","send","auth2","getAuthInstance","then"],"mappings":"AACA,QAASA,WACLC,QAAQC,IAAIC,OAEhB,QAASC,WAAUC,GACjBJ,QAAQC,IAAIG,GACZC,UAAUC,UAAUF,EAAMG,QAG5B,QAASC,gBACPC,KAAKC,QAAQC,OAAO,cAClBC,MAAS,uBACTC,OAAU,GACVC,WAAa,EACbC,UAAaC,SACbC,UAAad,YAEfe,YAAcC,WAAWC,kBAAmB,IAE9C,QAASA,qBACHC,EAAE,iBAAiBC,IAAI,SACzBD,EAAE,iBAAiBC,IAAI,QAAS,QAEhCJ,YAAcC,WAAWC,kBAAmB,IAGhD,QAASJ,UAASO,GAEhB,GAAIC,GAAUD,EAAWE,iBACzBzB,SAAQC,IAAI,OAASuB,EAAQE,SAC7B1B,QAAQC,IAAI,SAAWuB,EAAQG,WAC/B3B,QAAQC,IAAI,cAAgBuB,EAAQI,eACpC5B,QAAQC,IAAI,UAAYuB,EAAQK,WAChC,IAAIC,GAAWP,EAAWQ,kBAAkBD,QAC5C9B,SAAQC,IAAI,aAAe6B,GAE3BzB,UAAU2B,KAAK,QAAQ,OAEvB,IAAIC,GAAM,GAAIC,eACdD,GAAIE,KAAK,OAAQ,0BACjBF,EAAIG,iBAAiB,eAAgB,qCACrCH,EAAII,OAAS,WACXrC,QAAQC,IAAI,iBAAmBgC,EAAIK,aACnC,IAAIC,GAAOlB,EAAEmB,UAAUP,EAAIK,aACR,OAAfC,EAAKE,QACPC,UACArC,UAAUC,UAAUiC,EAAKI,UAEzBC,SAASC,QAAQ3C,MAAQ,gBAG7B+B,EAAIa,KAAK,WAAahB,GAExB,QAASY,WACP,GAAIK,GAAQtC,KAAKsC,MAAMC,iBACvBD,GAAML,UAAUO,KAAK,WACnBjD,QAAQC,IAAI,sBAxDhBoB,EAAEtB,QAQF,IAAImB,aAAc","file":"js/mng/login.js","sourcesContent":["$(onReady);\nfunction onReady() {\n    console.log(vpath);\n}\nfunction onFailure(error) {\n  console.log(error);\n  pageAlert.showError(error.reason);\n}\nvar renderTimer = 0;\nfunction renderButton() {\n  gapi.signin2.render('my-signin2', {\n    'scope': 'profile email openid',\n    'height': 50,\n    'longtitle': true,\n    'onsuccess': onSignIn,\n    'onfailure': onFailure\n  });\n  renderTimer = setTimeout(checkRenderButton, 30);\n}\nfunction checkRenderButton() {\n  if ($(\".abcRioButton\").css(\"width\"))\n    $(\".abcRioButton\").css(\"width\", \"100%\");\n  else\n    renderTimer = setTimeout(checkRenderButton, 30);   \n}\n\nfunction onSignIn(googleUser) {\n  //scope = 'email profile openid'\n  var profile = googleUser.getBasicProfile();\n  console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.\n  console.log('Name: ' + profile.getName());\n  console.log('Image URL: ' + profile.getImageUrl());\n  console.log('Email: ' + profile.getEmail());\n  var id_token = googleUser.getAuthResponse().id_token;\n  console.log('ID Token: ' + id_token);\n\n  pageAlert.show('登入驗證中','info');\n\n  var xhr = new XMLHttpRequest();\n  xhr.open('POST', '/jason/api/tokensignin');\n  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n  xhr.onload = function() {\n    console.log('Signed in as: ' + xhr.responseText);\n    var _obj = $.parseJSON(xhr.responseText);\n    if (_obj.status != 'OK') {\n      signOut();\n      pageAlert.showError(_obj.message);\n    } else {\n      location.replace(vpath + '/mng/users/');\n    }\n  };\n  xhr.send('idtoken=' + id_token);\n}\nfunction signOut() {\n  var auth2 = gapi.auth2.getAuthInstance();\n  auth2.signOut().then(function () {\n    console.log('User signed out.');\n  });\n}"],"sourceRoot":"/source/"}