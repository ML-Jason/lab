{"version":3,"sources":["mng/js/login.js"],"names":["onReady","onFailure","error","console","log","pageAlert","showError","title","text","reason","renderButton","gapi","signin2","render","scope","height","longtitle","onsuccess","onSignIn","onfailure","renderTimer","setTimeout","checkRenderButton","$","css","googleUser","profile","getBasicProfile","getId","getName","getImageUrl","getEmail","id_token","getAuthResponse","show","type","xhr","XMLHttpRequest","open","setRequestHeader","onload","responseText","_obj","parseJSON","status","signOut","message","_path","Cookies","get","vpath","location","replace","send","auth2","getAuthInstance","then"],"mappings":"AACA,QAASA,YAGT,QAASC,WAAUC,GACjBC,QAAQC,IAAIF,GACZG,UAAUC,WACRC,MAAS,OACTC,KAASN,EAAMO,SAInB,QAASC,gBACPC,KAAKC,QAAQC,OAAO,cAClBC,MAAS,uBACTC,OAAU,GACVC,WAAa,EACbC,UAAaC,SACbC,UAAalB,YAEfmB,YAAcC,WAAWC,kBAAmB,IAE9C,QAASA,qBACHC,EAAE,iBAAiBC,IAAI,SACzBD,EAAE,iBAAiBC,IAAI,QAAS,QAEhCJ,YAAcC,WAAWC,kBAAmB,IAGhD,QAASJ,UAASO,GAEhB,GAAIC,GAAUD,EAAWE,iBACzBxB,SAAQC,IAAI,OAASsB,EAAQE,SAC7BzB,QAAQC,IAAI,SAAWsB,EAAQG,WAC/B1B,QAAQC,IAAI,cAAgBsB,EAAQI,eACpC3B,QAAQC,IAAI,UAAYsB,EAAQK,WAChC,IAAIC,GAAWP,EAAWQ,kBAAkBD,QAC5C7B,SAAQC,IAAI,aAAe4B,GAE3B3B,UAAU6B,MACR3B,MAAQ,QACR4B,KAAO,QAGT,IAAIC,GAAM,GAAIC,eACdD,GAAIE,KAAK,OAAQ,0BACjBF,EAAIG,iBAAiB,eAAgB,qCACrCH,EAAII,OAAS,WACXrC,QAAQC,IAAI,iBAAmBgC,EAAIK,aACnC,IAAIC,GAAOnB,EAAEoB,UAAUP,EAAIK,aAC3B,IAAmB,MAAfC,EAAKE,OACPC,UACAxC,UAAUC,WAAWC,MAAQmC,EAAKI,cAC7B,CACL,GAAIC,GAAQC,QAAQC,IAAI,UAAYC,MAAQ,YAE5CC,UAASC,QAAQL,KAGrBX,EAAIiB,KAAK,WAAarB,GAExB,QAASa,WACP,GAAIS,GAAQ3C,KAAK2C,MAAMC,iBACvBD,GAAMT,UAAUW,KAAK,WACnBrD,QAAQC,IAAI,sBAhEhBmB,EAAEvB,QAWF,IAAIoB,aAAc","file":"mng/js/login.js","sourcesContent":["$(onReady);\nfunction onReady() {\n    //console.log(vpath);\n}\nfunction onFailure(error) {\n  console.log(error);\n  pageAlert.showError({\n    \"title\": \"登入錯誤\",\n    \"text\" : error.reason\n  });\n}\nvar renderTimer = 0;\nfunction renderButton() {\n  gapi.signin2.render('my-signin2', {\n    'scope': 'profile email openid',\n    'height': 50,\n    'longtitle': true,\n    'onsuccess': onSignIn,\n    'onfailure': onFailure\n  });\n  renderTimer = setTimeout(checkRenderButton, 30);\n}\nfunction checkRenderButton() {\n  if ($(\".abcRioButton\").css(\"width\"))\n    $(\".abcRioButton\").css(\"width\", \"100%\");\n  else\n    renderTimer = setTimeout(checkRenderButton, 30);   \n}\n\nfunction onSignIn(googleUser) {\n  //scope = 'email profile openid'\n  var profile = googleUser.getBasicProfile();\n  console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.\n  console.log('Name: ' + profile.getName());\n  console.log('Image URL: ' + profile.getImageUrl());\n  console.log('Email: ' + profile.getEmail());\n  var id_token = googleUser.getAuthResponse().id_token;\n  console.log('ID Token: ' + id_token);\n\n  pageAlert.show({\n    'title':'登入驗證中',\n    'type':'info'\n  });\n\n  var xhr = new XMLHttpRequest();\n  xhr.open('POST', '/jason/api/tokensignin');\n  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n  xhr.onload = function() {\n    console.log('Signed in as: ' + xhr.responseText);\n    var _obj = $.parseJSON(xhr.responseText);\n    if (_obj.status != 'OK') {\n      signOut();\n      pageAlert.showError({\"title\":_obj.message});\n    } else {\n      var _path = Cookies.get(\"_path\") || vpath + '/mng/users';\n      //console.log(_path);\n      location.replace(_path);\n    }\n  };\n  xhr.send('idtoken=' + id_token);\n}\nfunction signOut() {\n  var auth2 = gapi.auth2.getAuthInstance();\n  auth2.signOut().then(function () {\n    console.log('User signed out.');\n  });\n}"],"sourceRoot":"/source/"}