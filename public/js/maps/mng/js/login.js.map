{"version":3,"sources":["mng/js/login.js"],"names":["onReady","onFailure","error","console","log","pageAlert","showError","title","text","reason","renderButton","gapi","signin2","render","scope","height","longtitle","onsuccess","onSignIn","onfailure","renderTimer","setTimeout","checkRenderButton","$","css","googleUser","profile","getBasicProfile","getId","getName","getImageUrl","getEmail","id_token","getAuthResponse","show","type","xhr","XMLHttpRequest","open","setRequestHeader","onload","responseText","_obj","parseJSON","status","signOut","message","_path","Cookies","get","vpath","location","replace","send","auth2","getAuthInstance","then"],"mappings":"AACA,QAASA,YAGT,QAASC,WAAUC,GACjBC,QAAQC,IAAIF,GACZG,UAAUC,WACRC,MAAS,OACTC,KAASN,EAAMO,SAInB,QAASC,gBACPC,KAAKC,QAAQC,OAAO,cAClBC,MAAS,uBACTC,OAAU,GACVC,WAAa,EACbC,UAAaC,SACbC,UAAalB,YAEfmB,YAAcC,WAAWC,kBAAmB,IAE9C,QAASA,qBACHC,EAAE,iBAAiBC,IAAI,SACzBD,EAAE,iBAAiBC,IAAI,QAAS,QAEhCJ,YAAcC,WAAWC,kBAAmB,IAGhD,QAASJ,UAASO,GAEhB,GAAIC,GAAUD,EAAWE,iBACzBxB,SAAQC,IAAI,OAASsB,EAAQE,SAC7BzB,QAAQC,IAAI,SAAWsB,EAAQG,WAC/B1B,QAAQC,IAAI,cAAgBsB,EAAQI,eACpC3B,QAAQC,IAAI,UAAYsB,EAAQK,WAChC,IAAIC,GAAWP,EAAWQ,kBAAkBD,QAC5C7B,SAAQC,IAAI,aAAe4B,GAE3B3B,UAAU6B,MACR3B,MAAQ,QACR4B,KAAO,QAGT,IAAIC,GAAM,GAAIC,eACdD,GAAIE,KAAK,OAAQ,0BACjBF,EAAIG,iBAAiB,eAAgB,qCACrCH,EAAII,OAAS,WACXrC,QAAQC,IAAI,iBAAmBgC,EAAIK,aACnC,IAAIC,GAAOnB,EAAEoB,UAAUP,EAAIK,aAC3B,IAAmB,MAAfC,EAAKE,OACPC,UACAxC,UAAUC,WAAWC,MAAQmC,EAAKI,cAC7B,CACL,GAAIC,GAAQC,QAAQC,IAAI,UAAYC,MAAQ,YAE5CC,UAASC,QAAQL,KAGrBX,EAAIiB,KAAK,WAAarB,GAExB,QAASa,WACP,GAAIS,GAAQ3C,KAAK2C,MAAMC,iBACvBD,GAAMT,UAAUW,KAAK,WACnBrD,QAAQC,IAAI,sBAhEhBmB,EAAEvB,QAWF,IAAIoB,aAAc","file":"mng/js/login.js","sourcesContent":["$(onReady);\r\nfunction onReady() {\r\n    //console.log(vpath);\r\n}\r\nfunction onFailure(error) {\r\n  console.log(error);\r\n  pageAlert.showError({\r\n    \"title\": \"登入錯誤\",\r\n    \"text\" : error.reason\r\n  });\r\n}\r\nvar renderTimer = 0;\r\nfunction renderButton() {\r\n  gapi.signin2.render('my-signin2', {\r\n    'scope': 'profile email openid',\r\n    'height': 50,\r\n    'longtitle': true,\r\n    'onsuccess': onSignIn,\r\n    'onfailure': onFailure\r\n  });\r\n  renderTimer = setTimeout(checkRenderButton, 30);\r\n}\r\nfunction checkRenderButton() {\r\n  if ($(\".abcRioButton\").css(\"width\"))\r\n    $(\".abcRioButton\").css(\"width\", \"100%\");\r\n  else\r\n    renderTimer = setTimeout(checkRenderButton, 30);   \r\n}\r\n\r\nfunction onSignIn(googleUser) {\r\n  //scope = 'email profile openid'\r\n  var profile = googleUser.getBasicProfile();\r\n  console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.\r\n  console.log('Name: ' + profile.getName());\r\n  console.log('Image URL: ' + profile.getImageUrl());\r\n  console.log('Email: ' + profile.getEmail());\r\n  var id_token = googleUser.getAuthResponse().id_token;\r\n  console.log('ID Token: ' + id_token);\r\n\r\n  pageAlert.show({\r\n    'title':'登入驗證中',\r\n    'type':'info'\r\n  });\r\n\r\n  var xhr = new XMLHttpRequest();\r\n  xhr.open('POST', '/jason/api/tokensignin');\r\n  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n  xhr.onload = function() {\r\n    console.log('Signed in as: ' + xhr.responseText);\r\n    var _obj = $.parseJSON(xhr.responseText);\r\n    if (_obj.status != 'OK') {\r\n      signOut();\r\n      pageAlert.showError({\"title\":_obj.message});\r\n    } else {\r\n      var _path = Cookies.get(\"_path\") || vpath + '/mng/users';\r\n      //console.log(_path);\r\n      location.replace(_path);\r\n    }\r\n  };\r\n  xhr.send('idtoken=' + id_token);\r\n}\r\nfunction signOut() {\r\n  var auth2 = gapi.auth2.getAuthInstance();\r\n  auth2.signOut().then(function () {\r\n    console.log('User signed out.');\r\n  });\r\n}"],"sourceRoot":"/source/"}